<div
  id="qarinai-bubble-wrapper"
  class="fixed bottom-8 right-8 z-[999999999] flex flex-row-reverse items-end justify-end gap-4"
>
  <div
    class="w-20 h-20 p-4 rounded-full bg-zinc-950 text-white cursor-pointer shadow-lg hover:rotate-180 hover:bg-zinc-800 transition-all duration-300"
    (click)="windowOpened.set(!windowOpened())"
  >
    <app-qarin-logo></app-qarin-logo>
  </div>

  @if(windowOpened()) {
  <div
    class="w-[24rem] h-[32rem] bg-zinc-950 rounded-lg rounded-br-none shadow-lg flex flex-col overflow-hidden text-white"
  >
    @if (configError()) {
    <div class="flex w-full h-full justify-center items-center">
      <div class="text-center">
        <fa-icon
          [icon]="icons.warning"
          class="text-yellow-400 mb-2"
          size="3x"
        ></fa-icon>
        <h2 class="text-lg font-semibold mb-2">Configuration Error</h2>
        <p class="text-sm text-zinc-400">
          Please check your configuration settings.
        </p>
      </div>
    </div>
    } @else {
    <div class="flex items-center justify-between px-4 py-2 bg-zinc-800">
      <div>{{ agent()?.name }}</div>
      <div>
        <button
          type="button"
          class="rounded-full relative hover:bg-zinc-700 w-8 h-8 cursor-pointer transition-colors duration-300 set hover:*:block group"
          (click)="restartConversation()"
        >
          <fa-icon [icon]="icons.refresh" />
          <div
            class="absolute text-sm bg-zinc-800 p-2 border border-zinc-500 rounded right-0 hidden transition-all duration-300"
          >
            Restart Conversation
          </div>
        </button>
        <button
          type="button"
          class="rounded-full hover:bg-zinc-700 w-8 h-8 cursor-pointer transition-colors duration-300"
          (click)="windowOpened.set(false)"
        >
          <fa-icon [icon]="icons.close" />
        </button>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto p-4">
      @for(message of messagesList(); track message) {
      <app-message
        [role]="message.role"
        [content]="message.content"
      ></app-message>
      } @if(isLastMessageUser()) {
      <div class="flex">
        <fa-icon
          [icon]="icons.spinner"
          class="text-zinc-400 animate-spin"
        ></fa-icon>
      </div>
      }
    </div>

    <form
      class="flex flex-col shrink p-2 bg-zinc-800"
      [ngClass]="{
        'shimmer': shouldNotSendMessage()
      }"
    >
      <textarea
        type="text"
        placeholder="Type your message..."
        [(ngModel)]="userMessage"
        [rows]="textareaRows()"
        name="userMessage"
        (keydown)="onMessageKeydown($event)"
        [disabled]="shouldNotSendMessage()"
        class="w-full p-2 rounded bg-zinc-700 placeholder:text-zinc-400 disabled:opacity-50 text-white focus:outline-none resize-none focus:ring-2 focus:ring-slate-500 transition-all duration-300"
      ></textarea>
    </form>
    }
  </div>
  }
</div>
