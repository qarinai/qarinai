<div class="flex justify-center">
  <p-stepper [linear]="true" class="w-full" [value]="currentStep()">
    <div class="card" style="margin-bottom: 0">
      <p-step-list>
        <p-step [value]="1">Import MCP Server</p-step>
        <p-step [value]="2">Select Tools</p-step>
      </p-step-list>
    </div>

    <p-step-panels>
      <p-step-panel [value]="1">
        <ng-template #content let-activateCallback="activateCallback">
          <div class="flex flex-col">
            <div class="step-content">
              <div class="card">
                <form class="flex flex-col gap-4" [formGroup]="form">
                  <div class="flex flex-col gap-2 w-full">
                    <label for="mcp-url"> MCP Server URL </label>
                    <input
                      id="mcp-url"
                      type="text"
                      pInputText
                      name="mcpUrl"
                      formControlName="mcpUrl"
                      required
                      placeholder="Enter MCP Server URL"
                    />
                  </div>

                  <div class="flex flex-col gap-2 w-full">
                    <label for="name">Name</label>
                    <input
                      type="text"
                      pInputText
                      name="name"
                      formControlName="name"
                      required
                      placeholder="Give it a name"
                    />
                  </div>
                  <div class="flex flex-col gap-2 w-full">
                    <label for="description">Description</label>
                    <textarea
                      type="text"
                      pInputText
                      name="description"
                      formControlName="description"
                      required
                      placeholder="Give it a descriptions to help LLMs to know when to access it"
                    ></textarea>
                  </div>

                  <div class="flex flex-col gap-2 w-full">
                    <label for="token-type">Authorization</label>
                    <p-select formControlName="tokenType" [options]="availableTokenTypes"> </p-select>
                  </div>

                  @if (form.get('tokenType')?.value) {
                    <div class="flex flex-col gap-2 w-full">
                      <label for="token">Access Token</label>
                      <input
                        id="token"
                        type="password"
                        pInputText
                        formControlName="tokenValue"
                        name="accessToken"
                        required
                        placeholder="Enter Access Token"
                        class="w-full"
                      />
                    </div>
                  }
                </form>
              </div>
            </div>
            <div class="flex pt-6 justify-end">
              <p-button
                [loading]="toolsLoading()"
                label="Next"
                icon="pi pi-arrow-right"
                iconPos="right"
                (onClick)="onStep2Click()"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-step-panel>

      <p-step-panel [value]="2">
        <ng-template #content let-activateCallback="activateCallback">
          <div class="flex flex-col">
            <div class="step-content">
              <div class="card">
                <p-table [value]="loadedTools()" [(selection)]="selectedTools" dataKey="name">
                  <ng-template #caption>
                    <div class="flex items-center justify-between">
                      <h5 class="m-0">Available Tools</h5>
                    </div>
                  </ng-template>
                  <ng-template #header>
                    <tr>
                      <th>
                        <p-tableHeaderCheckbox />
                      </th>
                      <th>Name</th>
                      <th>Description</th>
                    </tr>
                  </ng-template>

                  <ng-template #body let-tool>
                    <tr>
                      <td>
                        <p-tableCheckbox [value]="tool"></p-tableCheckbox>
                      </td>
                      <td>
                        {{ tool.name }}
                      </td>
                      <td>
                        {{ tool.description }}
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </div>
            <div class="flex pt-6 justify-between">
              <p-button
                label="Previous"
                icon="pi pi-arrow-                      "
                iconPos="left"
                (onClick)="currentStep.set(1)"
              ></p-button>
              <p-button label="Save" icon="pi pi-arrow-right" iconPos="right" (onClick)="onSaveClick()"></p-button>
            </div>
          </div>
        </ng-template>
      </p-step-panel>
    </p-step-panels>
  </p-stepper>
</div>
